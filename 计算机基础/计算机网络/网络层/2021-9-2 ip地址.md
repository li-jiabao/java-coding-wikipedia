# IP地址

### 1 IP地址分类

- A类IP：首位为0，网络号7位，主机号24位

- B类IP：第二位为0，网络号14位，主机号16位

- C类地址：第三位为0，网络号21位，主机号8位

- D类地址：第四位为0，无主机位，用于多播的IP地址

- E类地址：第五位为0，无主机位，暂时未分配，留待后用

<font color='red'>网络号</font>：标识IP地址属于互联网的哪一个网络

<font color='red'>主机号</font>：表示指定网络下的哪一个主机

指定网络下面的可用IP地址数计算：2的主机号位数次方-2，因为全为0代表该网络，全为1代表广播地址

### 为什么IP地址分离网络号和主机号？

<font color='red'>因为两台计算机想要通讯，首先需要判断是否处于同一个广播域内，也就是网络地址（网络号）是否相同</font>：

- 网络地址相同：表明在同一个网络地址下，可以直接把数据包发送到目标主机上，不需要转发到其他的网络
- 网络地址不同：网络号不同主机称为<font color='red'>远程网络主机</font>，远程网络主机相互通信需要通过本地网关（gateway）来传递转发数据。

路由器在进行IP地址寻址的时候，就是通过查找对应的网络号，从而找到对应的网络并发送到该网络进行转发给到对应主机。

<font color='red'>IP地址分类的优点</font>：

- 路由器和主机解析IP地址，可以快速找到对应的网络地址和主机地址
- 网络地址解析：通过判断IP地址的前面几位是0还是1，这也是IP地址分类的方法
- 实际的网络地址是通过子网掩码来进行解析的

## 2 IP广播/单播/多播

### IP广播

某个网络下的主机号全为1的IP地址用于广播，什么是广播？

<font color='red'>广播</font>：用于在同一个链路中相互连接的主机之间发送数据包，一个发送方对应多个接收方。主机接收到数据之后，可以根据需求选择使用还是丢弃。

<font color='red'>简单的例子</font>：校园广播，通知指定的同学到教务处一趟，这个广播是全校都能接受到的，但是只要被通知的这些同学会做出响应，其他同学还是该干嘛干嘛。网络广播也是如此，有需要的主机才会对接收到的数据做出响应

广播按照IP地址可以分为<font color='red'>本地广播</font>和<font color='red'>直接广播</font>：

- <font color='red'>本地广播</font>：在同一网络之间广播。广播地址会被路由器屏蔽（<font color='red'>路由器不会转发该广播，广播包无法穿透路由</font>）
- <font color='red'>直接广播</font>：在不同网络之间广播。不同网络之间广播的数据包可以跨路由器转发。但是由于直接广播存在安全问题，路由器默认设置不转发，广播包无法穿透路由

### IP单播

<font color='red'>单播</font>：只有一个发送方和一个接收方，单播可以穿透路由器，路由器对于单播包会进行转发



### IP多播

<font color='red'>多播</font>：将包发送给特定组内的所有主机（可以穿透路由器），一个发送发，多个接收方

多播使用的地址是IP地址中D类地址，首位1110。

👍 在人们使用多播功能之前，一直采用广播的方式。<font color='red'>通过广播将数据发送给所有终端主机，再由这些主机 IP 之上的一层去判断是否有必要接收数据。这种方式会给那些毫无关系的网络或主机带来影响，造成网络上很多不必要的流量</font>。再者，由于我们在大部分情况下使用的本地广播是无法穿透路由的，所以多播这种既能够穿透路由，又可以实现只给那些必要的组发送数据包的技术就成为必选之路了。

## 3 IP地址子网划分

### 为什么划分子网？

传统的两级IP地址划分可能存在资源浪费。

比如B类网络，主机号16位，<font color='red'>可用主机数量很大，但是实际中一个链路不可能连接这么多的主机</font>。因此，对于A、B、C类地址直接使用，有些浪费主机号。

为了解决这个问题，衍生了子网划分的概念

### 子网划分

子网划分方法：将传统的两次划分改为三级划分（网络号+子网号+主机号），也就是在主机号中抽出几位来区分子网，主机号划分为（子网+子网主机号），对于子网主机号，也是不能全为0或者全为1。

🚨 注意：**某单位划分子网后，对外仍表现为一个网络，即本单位外的网络看不见本单位内的子网划分**。如：将网络地址 `145.13.0.0` 划分成 3 个子网，子网的网络地址分别为 `145.13.3.0`、`145.13.7.0`、`145.13.21.0`：

- 网络地址：只指定了网络号，未指定主机号，主机号全 0。
- 子网的网络地址：指定了网络号和子网号，未指定主机号，主机号全 0。

### 子网掩码

**<font color='red'>子网掩码</font>**：将某个IP地址划分成为网络号和主机号

<font color='red'>子网掩码定义</font>：

- 网络号对应的子网掩码位全为1
- 子网号对应的子网掩码位也为1
- 主机号对应的子网掩码位为0

进行了如上的定义之后，如何获取网络号和主机号呢？

将IP地址和子网掩码进行与运算即可直到网络号位数和主机号位数，同时还可以知道子网号位数。

<font color='red'>网络号位数计算</font>：通过IP地址的五大分类可以计算得到网络号位数：A->8、B->16、C->24

<font color='red'>子网号位数</font>：通过子网掩码的1的位数减去网络号位数可得

<font color='red'>主机号位数</font>：通过子网掩码的0的位数可得

IP地址的子网地址表示：

- IP地址和子网掩码共同表示：192.168.1.0和255.255.255.192
- 简化表示：192.168.1.0/26，26表示网络号+子网号

## IPV4地址枯竭问题

随着计算机数量的不断增加，可用的IP地址越来越少，现行的几种解决方案：

- 无分类IP地址CIDR
- NAT地址转换
- IPV6（使用128比特）：相比IPV4（仅32比特），IPV6可提供数量更多，也是最根本的解决方案

### 无分类IP地址CIDR



### NAT地址转换





## 路由控制

<font color='red'>将IP数据报发送给最终目标地址的功能</font>

### 路由控制表

这是主机和路由器上都维护这的数据表，表记录了两个字段：

- IP地址
- 到达该IP地址在当前路由器应该发送到哪个路由器

### 路由转发流程

发送数据报时，首先需要确定IP数据包中的目标地址，再从路由控制表中找到与该地址具有相同网络地址的表记录，根据记录将IP数据报发送给下一个路由器，<font color='red'>如果记录表存在多条相同网络地址的记录，就选择相同位数最多的网络地址，最长匹配</font>

转发流程示例：

- 主机A要发送数据报，源地址`10.1.1.30`，目标地址`10.1.2.10`，由于主机A的路由记录表中

<font color='red'>默认路由</font>：对IP数据报中的目的地址找不到存在对应的路由记录时，路由器所选择的路由。当目的地址不在路由器的路由表中的数据报都会使用默认路由进行转发。默认路由一般会连接另外一个路由，让这个路由去处理数据报，如果路由表可以找到记录，则转发到已知路由，否则继续跳转到该路由器的默认路由，从而到达另外一个路由。每一次转发，都会转向下一个路由，增加一跳的距离。（<font color='red'>防止路由控制表没有记录时卡住不能继续往下传输</font>）

Linux下指定默认路由的命令：`ip route add default via 192.168.137.1`



### 路由协议