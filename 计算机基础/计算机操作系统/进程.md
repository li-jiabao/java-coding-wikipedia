# 进程

## 1 进程通信

### 1.1 为什么要进行进程通信？

- 数据传输：一个进程的数据需要发送到另外一个进程
- 资源共享：进程之间共享相同的资源
- 通知事件：进程之间发送消息，通知某种事件的发生
- 进程控制：有些进程需要控制另外进程的执行，了解进程的状态

### 1.2 进程通信的原理

不同进程之间所使用的用户空间地址都是不同的，任何进程的全局变量在另外一个进程中是查看不到的。因此进程之间想要交换数据、进程通信，就需要在内核中开辟一个缓冲区，用来把数据从用户空间拷贝到内核空间，然后内核调度传递给进程。

内核对进程数据的缓冲和传递就是内核的进程通信机制

![image-20210919110140652](https://gitee.com/Jia_bao_Li/img/raw/master/img/%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E3%80%81.png)

### 1.3 进程通信方式

#### 1.3.1 管道

利用pipe函数创建一个管道，这个管道就是在内核中开辟一块缓冲区用来通信。管道由读端和写端组成。

实质上管道的读写就是内核缓冲区的读写。管道存在于内存中的文件

通信对象：

- 具有亲缘关系的父子进程
- 具有亲缘关系的兄弟进程

管道的缺点：

- 管道通信是单向的
- 缓冲区大小受限制
- 只能具有亲缘关系的进程之间通信
- 管道传送的是无格式字节流，管道读写双方需要事先约定数据格式（如多少字节算作一个消息）

#### 1.3.2 命名管道FIFO

为了克服匿名管道只能用于亲缘关系之间的进程通信而提出的一种管道。

命名管道严格遵循先进先出FIFO。

命名管道以**磁盘文件**形式存储，可以实现本机**任意两个进程通信**。

#### 1.3.3 消息队列

消息队列时消息的链表，具有特定格式，存放在捏村中并由消息队列标识符标识，管道和消息队列的通信数据都是先进先出的原则。

消息队列存放在内核中，只有内核重启或者删除消息队列时，该消息队列才会消失。

消息队列可以实现消息的随机查询，消息不一定要以先进先出的次序读取，也可按照消息的类型读取，比FIFO更具优势。

消息队列克服了信号承载信息量少，管道只能承载无格式字节流以及缓冲区大小受限制的缺陷

#### 1.3.4 信号量

信号量是一个计数器，用于多进程对共享数据的访问，信号量的意图在于进程间同步，这种通信方式主要是用来解决同步相关的问题并避免竟态条件。

#### 1.3.5 信号

用于通知接收进程某个事件已经发生

- 信号可以在任意时刻发送给任意一个进程，无需知道该进程状态

信号是软件层级对中断机制的一种模拟，是一种异步通信机制，<font color='red'>信号可以在用户空间进程和内核之间直接交互</font>。内核可以通过信号来通知用户空间进程发生了哪些系统事件，信号时间主要有两个来源：

- 硬件来源：IO设备的异常或者用户键盘输入ctrl+c
- 软件中止：中止进程信号、其他进程调用kill函数、软件异常产生的信号等

#### 1.3.6 共享内存

多个进程可以访问同一块内存空间，不同内存可以及时看到进程对共享内存数据的更新

这种方式需要用到某些同步机制，比如互斥锁、信号量。

<font color='red'>最快最有用的进程通信方式</font>

#### 1.3.7 Socket套接字

此方法主要用于客户端和服务端进程之间进行通信，支持TCP\IP网络通信。

使用套接字来完成两端主机之间的通信过程

## 2 进程调度算法

- 先到先服务（FCFS）：从就绪队列中选择一个最早进入该队列的进程分配资源让其可以执行
- 短作业优先（SJF）：从就绪队列中选择一个预估执行时间最短的任务先执行
- 时间片轮转算法：最古老、最简单、最公平使用最广。每个进程分配一个时间段（进程时间片），这个时间片是进程云心执行的时间
- 多级反馈队列调度算法：可以让高优先级的作业得到响应，同时还能使得短作业尽可能快的完成。公认较好的一种算法
- 优先级调度：根据每个进程的紧要成都分配相应的优先级，首先执行优先级高的进程，具有相同优先级的就按照先到先执行的FCFS算法执行。一般优先级计算：内存要求、时间要求、其他资源的要求确定优先级
