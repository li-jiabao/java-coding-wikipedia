# 索引

## 哈希索引

其实就是基于哈希算法计算键所对应的索引位置，这样可以快速的定位你所需要查找的特定元素。

哈希算法的好坏决定了元素查找的快慢以及哈希冲突出现的可能性。

哈希冲突：不同的键经过哈希函数计算得到的数值一样，这种情况称为哈希冲突。

解决哈希冲突的方法：

- 链表法：将出现哈希冲突的元素放到一个链表中。查找出现哈希的元素时，就是去遍历链表，找到对应的键时就返回值
- 找下一个可用的地址：出现哈希冲突就重新找位置

哈希索引优点：

- 查找插入很快，O(1)时间复杂度，出现哈希冲突也比较快，链表长度只要不是很离谱

哈希索引的缺点：

- 不能范围查找，对于有范围查找需要的情况，效率其实并不好

## 树

### 1 二叉搜索树BST

二叉搜索树值左子树值小于根节点，右子树值大于根节点，每个节点所在的数都满足这一条件

二叉搜索树查找构建的平均时间复杂度是O(logn)，但是在最坏情况下，时间复杂度会达到O(n)

由于普通的二叉树的极端条件不平稳，因此并适合直接作为索引方案

### 2 平衡树（AVL树和红黑树）

红黑树底层就是二叉树，通过自选和变色操作来达到二叉树的平衡（黑节点的平衡）

但是实际上红黑树会存在一个问题就是右倾（树的形状也会慢慢的偏离完全平衡二叉树）

AVL树完全平衡的二叉树，相比红黑树的查找效率更高一些，但是为了构建完全平衡二叉树，耗费的代价也不低

平衡二叉树作为索引使用的话看起来也很不错，但是实际瓶颈不仅仅只在查找数据上，还存在IO的问题，如果你IO次数多，也会导致效率低下。

<font color='red'>磁盘IO：从磁盘读取1B数据和1KB数据消耗时间基本一样</font>

因此为了解决IO的问题，让每个树节点存储尽可能多的数据，一次IO多加载点数据，这一类树叫做B树

### 3 B树

让每一个二叉树结点多存放一些数据，这样每次IO读取更多的数据，减少磁盘的IO

优点：

- 优秀的检索速度：时间复杂度O(hlog(n))
- 尽可能少的IO，增加检索速度
- 支持范围查找

![image-20210924202102202](https://gitee.com/Jia_bao_Li/img/raw/master/img/B%E6%A0%91.png)

### 4 B+树

相比B树，B+树：

- 结点存放的是索引（地址），所以B树里面一个节点存不了很多数据，B+树可以存储很多个索引，B+树叶子节点存储所有的数据
- B+树的叶子节点是用链表串联起来，方便范围查找

![image-20210924202036713](https://gitee.com/Jia_bao_Li/img/raw/master/img/B+%E6%A0%91.png)

B+树为了在数据插入删除过程中保持平衡，需要进行旋转操作或者页的拆分来保证树的平衡。

叶子节点的分页操作实际上需要磁盘的操作，而为了保证效率就需要尽量保证少出现叶子节点的拆分，因此B+Tree一般先通过旋转来进行树的平衡，当通过旋转不能达到树的平衡就需要进行叶子节点的拆分来保证树平衡

B+树索引在数据库中有一个特点高扇出性，因此数据库中，B+树的高度一般都只是2-4层，因此一般只需要2-4次IO即可找到需要的数据页，效率还是很可观的

数据库中的B+树索引可以分为聚集索引和辅助索引

#### 聚集索引

聚集索引：按照每个表的主键来构造一颗B+树，同时叶子节点中存放的是整张表的记录数据，聚集索引的叶子节点也称之为数据页。聚集索引能够直接在叶子结点上找到数据，此外可以根据数据的逻辑顺序快速定位某个范围值的查询。查询优化器可以借助聚集索引快速发现某一段的数据页需要扫描

聚集索引对于主键的排序查找和范围查找都非常的快，因为叶子节点存储的数据就是用户所需要查找的数据，只需要查询到索引位于的叶子结点就能立马获取到查询的数据

#### 辅助索引

辅助索引：叶子节点不包含行记录的全部数据，除了包含键值之外，每个叶子节点的索引行中包含了一个bookmark，用来告知InnoDB哪里可以找到与该索引相关的行数据。InnoDB的辅助索引中的bookmark就是指向行数据所对应的聚集索引

辅助索引的存在并不影响在聚集索引中的数据安排，因此每张数据表可以存在多个辅助索引。借助辅助索引首先查询到对应的叶子节点，然后读取叶子节点上的bookmark（也就是聚集索引所在的位置），然后查询一次聚集索引，才能最终获取到对应的行数据

